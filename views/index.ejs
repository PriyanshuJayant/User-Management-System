<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Management System</title>
    <link rel="stylesheet" href="/index.css" />
  </head>

  <body>
    <div class="cosmic-nebula"></div>

    <div class="container">
      <h3>User Management System</h3>

      <form action="/api/" method="POST">
        <input type="text" name="fullName" placeholder="Full Name" required />
        <input type="email" name="email" placeholder="Email" required />
        <input type="number" name="age" placeholder="Age" required />
        <select name="gender" required>
          <option value="">Gender</option>
          <option value="male">Male</option>
          <option value="female">Female</option>
          <option value="other">Other</option>
        </select>
        <button type="submit">Add User</button>
      </form>

      <div class="table">
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Age</th>
              <th>Gender</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% users.forEach(user=> { %>
            <tr>
              <td><%= user.fullName %></td>
              <td><%= user.email %></td>
              <td><%= user.age %></td>
              <td><%= user.gender %></td>
              <td>
                <button
                  class="action-btn edit-btn"
                  onclick="openEditModal(
                                '<%= user._id %>',
                                '<%= user.fullName %>',
                                '<%= user.email %>',
                                '<%= user.age %>',
                                '<%= user.gender %>')"
                  title="Edit"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path
                      d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"
                    ></path>
                    <path
                      d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"
                    ></path>
                  </svg>
                </button>
                <form
                  action="/users/<%= user._id %>/delete"
                  method="POST"
                  style="display: inline"
                >
                  <button
                    type="submit"
                    class="action-btn delete-btn"
                    title="Delete"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <polyline points="3 6 5 6 21 6"></polyline>
                      <path
                        d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
                      ></path>
                      <line x1="10" y1="11" x2="10" y2="17"></line>
                      <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                  </button>
                </form>
              </td>
            </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>

    <div id="editModal">
      <form id="editForm" method="POST">
        <h3>Edit User</h3>

        <input
          type="text"
          name="fullName"
          id="editFullName"
          placeholder="Full Name"
          required
        />
        <input
          type="email"
          name="email"
          id="editEmail"
          placeholder="Email"
          required
        />
        <input
          type="number"
          name="age"
          id="editAge"
          placeholder="Age"
          required
        />

        <select name="gender" id="editGender" required>
          <option value="male">Male</option>
          <option value="female">Female</option>
          <option value="other">Other</option>
        </select>

        <div class="modal-buttons">
          <button type="submit">Update</button>
          <button type="button" onclick="closeEditModal()">Cancel</button>
        </div>
      </form>
    </div>

    <script>
      function openEditModal(id, fullName, email, age, gender) {
        document.getElementById("editFullName").value = fullName;
        document.getElementById("editEmail").value = email;
        document.getElementById("editAge").value = age;
        document.getElementById("editGender").value = gender;

        // Set form action dynamically
        document.getElementById("editForm").action = `/users/${id}/update`;

        document.getElementById("editModal").classList.add("active");
      }

      function closeEditModal() {
        document.getElementById("editModal").classList.remove("active");
      }

      // Close modal when clicking outside
      document
        .getElementById("editModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeEditModal();
          }
        });
    </script>
    <script src="/transitions.js"></script>
  </body>
</html>
